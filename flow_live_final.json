{
  "version": "7.3",
  "data_api_version": "3.0",
  "routing_model": {
    "s_find_bar": [
      "s_bar_results"
    ],
    "s_bar_results": [
      "s_bar_detail"
    ],
    "s_bar_detail": []
  },
  "screens": [
    {
      "id": "s_find_bar",
      "title": "Find a bar",
      "layout": {
        "type": "SingleColumnLayout",
        "children": [
          {
            "type": "Form",
            "name": "search_form",
            "children": [
              {
                "type": "TextInput",
                "name": "q",
                "label": "Search",
                "input-type": "text"
              },
              {
                "type": "Dropdown",
                "name": "area",
                "label": "Area",
                "data-source": "${data.areas}"
              },
              {
                "type": "Footer",
                "label": "Show results",
                "on-click-action": {
                  "name": "data_exchange",
                  "payload": {
                    "action_id": "a_show_results",
                    "fields": {
                      "q": "${search_form.q}",
                      "area": "${search_form.area}"
                    }
                  }
                }
              }
            ]
          }
        ]
      }
    },
    {
      "id": "s_bar_results",
      "title": "Select a bar",
      "layout": {
        "type": "SingleColumnLayout",
        "children": [
          {
            "type": "Form",
            "name": "results_form",
            "children": [
              {
                "type": "RadioButtonsGroup",
                "name": "selected_bar",
                "label": "Bars",
                "data-source": "${data.bars}",
                "on-select-action": {
                  "name": "data_exchange",
                  "payload": {
                    "action_id": "a_select_bar",
                    "fields": {
                      "bar_id": "${results_form.selected_bar}"
                    }
                  }
                }
              },
              {
                "type": "EmbeddedLink",
                "text": "\u25c0 Previous",
                "visible": "${data.page_token_prev} != null",
                "on-click-action": {
                  "name": "data_exchange",
                  "payload": {
                    "action_id": "a_paged_bars",
                    "page_token": "${data.page_token_prev}",
                    "filters": {
                      "q": "${data.q}",
                      "area": "${data.area}"
                    }
                  }
                }
              },
              {
                "type": "EmbeddedLink",
                "text": "Next \u25b6",
                "visible": "${data.page_token_next} != null",
                "on-click-action": {
                  "name": "data_exchange",
                  "payload": {
                    "action_id": "a_paged_bars",
                    "page_token": "${data.page_token_next}",
                    "filters": {
                      "q": "${data.q}",
                      "area": "${data.area}"
                    }
                  }
                }
              },
              {
                "type": "Footer",
                "label": "Back to search",
                "on-click-action": {
                  "name": "navigate",
                  "payload": {
                    "screen_id": "s_find_bar"
                  }
                }
              }
            ]
          }
        ]
      }
    },
    {
      "id": "s_bar_detail",
      "title": "Bar details",
      "layout": {
        "type": "SingleColumnLayout",
        "children": [
          {
            "type": "TextHeading",
            "text": "${data.bar_name}"
          },
          {
            "type": "TextBody",
            "text": "${data.location_text}"
          },
          {
            "type": "Form",
            "name": "detail_actions",
            "children": [
              {
                "type": "Footer",
                "label": "Open menu",
                "on-click-action": {
                  "name": "data_exchange",
                  "payload": {
                    "action_id": "a_open_menu",
                    "fields": {
                      "bar_id": "${data.bar_id}"
                    }
                  }
                }
              },
              {
                "type": "EmbeddedLink",
                "text": "Chat with bar",
                "visible": "${data.direct_chat_allowed} == true",
                "on-click-action": {
                  "name": "open_url",
                  "payload": {
                    "url": "${data.bar_chat_url}"
                  }
                }
              },
              {
                "type": "EmbeddedLink",
                "text": "Back",
                "on-click-action": {
                  "name": "navigate",
                  "payload": {
                    "screen_id": "s_bar_results"
                  }
                }
              }
            ]
          }
        ]
      }
    }
  ]
}
