{
  "version": "7.3",
  "flow": {
    "name": "flow.cust.bar_browser.v1",
    "screens": [
      {
        "id": "s_find_bar",
        "title": "Find a bar",
        "layout": {
          "type": "SingleColumnLayout",
          "children": [
            {
              "type": "Form",
              "name": "search_form",
              "children": [
                {
                  "type": "TextInput",
                  "name": "q",
                  "label": "Search",
                  "placeholder": "Bar name or landmark",
                  "input-type": "text"
                },
                {
                  "type": "Dropdown",
                  "name": "area",
                  "label": "Area",
                  "placeholder": "All areas",
                  "data-source": "${data.areas}"
                },
                {
                  "type": "Footer",
                  "label": "Show results",
                  "on-click-action": {
                    "name": "data_exchange",
                    "payload": {
                      "action_id": "a_show_results",
                      "fields": {
                        "q": "${search_form.q}",
                        "area": "${search_form.area}"
                      }
                    }
                  }
                }
              ]
            }
          ]
        }
      },
      {
        "id": "s_bar_results",
        "title": "Select a bar",
        "layout": {
          "type": "SingleColumnLayout",
          "children": [
            {
              "type": "Form",
              "name": "results_form",
              "children": [
                {
                  "type": "RadioButtonsGroup",
                  "name": "selected_bar",
                  "label": "Bars",
                  "data-source": "${data.bars}",
                  "on-select-action": {
                    "name": "data_exchange",
                    "payload": {
                      "action_id": "a_select_bar",
                      "fields": {
                        "bar_id": "${results_form.selected_bar}"
                      }
                    }
                  }
                },
                {
                  "type": "EmbeddedLink",
                  "text": "◀ Previous",
                  "visibility_condition": "${data.page_token_prev} != null",
                  "on-click-action": {
                    "name": "data_exchange",
                    "payload": {
                      "action_id": "a_paged_bars",
                      "page_token": "${data.page_token_prev}",
                      "filters": {
                        "q": "${data.q}",
                        "area": "${data.area}"
                      }
                    }
                  }
                },
                {
                  "type": "EmbeddedLink",
                  "text": "Next ▶",
                  "visibility_condition": "${data.page_token_next} != null",
                  "on-click-action": {
                    "name": "data_exchange",
                    "payload": {
                      "action_id": "a_paged_bars",
                      "page_token": "${data.page_token_next}",
                      "filters": {
                        "q": "${data.q}",
                        "area": "${data.area}"
                      }
                    }
                  }
                },
                {
                  "type": "Footer",
                  "label": "Back to search",
                  "on-click-action": {
                    "name": "navigate",
                    "payload": {
                      "screen_id": "s_find_bar"
                    }
                  }
                }
              ]
            }
          ]
        }
      },
      {
        "id": "s_bar_detail",
        "title": "Bar details",
        "layout": {
          "type": "SingleColumnLayout",
          "children": [
            {
              "type": "Text",
              "text": "${data.bar_name}\n${data.location_text}"
            },
            {
              "type": "Form",
              "name": "detail_actions",
              "children": [
                {
                  "type": "Footer",
                  "label": "Open menu",
                  "on-click-action": {
                    "name": "data_exchange",
                    "payload": {
                      "action_id": "a_open_menu",
                      "fields": {
                        "bar_id": "${data.bar_id}"
                      }
                    }
                  }
                },
                {
                  "type": "EmbeddedLink",
                  "text": "Chat with bar",
                  "visibility_condition": "${data.direct_chat_allowed} == 'true'",
                  "on-click-action": {
                    "name": "open_url",
                    "payload": {
                      "url": "${data.bar_chat_url}"
                    }
                  }
                },
                {
                  "type": "EmbeddedLink",
                  "text": "Back",
                  "on-click-action": {
                    "name": "navigate",
                    "payload": {
                      "screen_id": "s_bar_results"
                    }
                  }
                }
              ]
            }
          ]
        }
      }
    ]
  }
}
