{
  "version": "6.4",
  "screens": [
    {
      "id": "s_bar_identity",
      "title": "Bar identity",
      "layout": {
        "type": "single_column"
      },
      "data_exchange": {
        "submit": {
          "action": {
            "id": "a_onboard_identity"
          }
        }
      },
      "widgets": [
        {
          "type": "text_input",
          "id": "bar_name",
          "label": "Bar name",
          "required": true
        },
        {
          "type": "text_input",
          "id": "location_text",
          "label": "Location",
          "required": true
        },
        {
          "type": "text_input",
          "id": "country",
          "label": "Country",
          "required": true
        },
        {
          "type": "text_input",
          "id": "city_area",
          "label": "City/Area",
          "required": true
        },
        {
          "type": "footer_buttons",
          "buttons": [
            {
              "id": "BTN_CONTINUE",
              "title": "Continue",
              "action": {
                "type": "data_exchange",
                "id": "a_onboard_identity",
                "fields": {
                  "bar_name": "${widgets.bar_name.value}",
                  "location_text": "${widgets.location_text.value}",
                  "country": "${widgets.country.value}",
                  "city_area": "${widgets.city_area.value}"
                }
              }
            }
          ]
        }
      ]
    },
    {
      "id": "s_existing_bar",
      "title": "Existing listing",
      "layout": {
        "type": "single_column"
      },
      "widgets": [
        {
          "type": "text_block",
          "id": "w_existing_intro",
          "text": "We found an existing bar. Link it or go back to change the name."
        },
        {
          "type": "radio_list",
          "id": "w_existing_bars",
          "options_data_binding": "existing_bars",
          "empty_state": {
            "title": "No matches",
            "body": "Go back to adjust the name."
          }
        },
        {
          "type": "footer_buttons",
          "buttons": [
            {
              "id": "BTN_USE_EXISTING",
              "title": "Use this bar",
              "visibility_condition": "${widgets.w_existing_bars.value} != null",
              "action": {
                "type": "data_exchange",
                "id": "a_link_existing_bar",
                "fields": {
                  "existing_bar_id": "${widgets.w_existing_bars.value}",
                  "bar_name": "${data.bar_name}",
                  "location_text": "${data.location_text}",
                  "country": "${data.country}",
                  "city_area": "${data.city_area}"
                }
              }
            },
            {
              "id": "BTN_EDIT_NAME",
              "title": "Edit name",
              "action": {
                "type": "navigate",
                "next": "s_bar_identity"
              }
            }
          ]
        }
      ]
    },
    {
      "id": "s_contact_payment",
      "title": "Contacts & MoMo",
      "layout": {
        "type": "single_column"
      },
      "data_exchange": {
        "submit": {
          "action": {
            "id": "a_onboard_contacts"
          }
        }
      },
      "widgets": [
        {
          "type": "text_input",
          "id": "order_numbers_csv",
          "label": "Staff numbers (comma separated)",
          "required": true
        },
        {
          "type": "text_input",
          "id": "momo_code",
          "label": "MoMo code"
        },
        {
          "type": "footer_buttons",
          "buttons": [
            {
              "id": "BTN_SAVE_CONTACTS",
              "title": "Save",
              "action": {
                "type": "data_exchange",
                "id": "a_onboard_contacts",
                "fields": {
                  "bar_id": "${data.bar_id}",
                  "order_numbers_csv": "${widgets.order_numbers_csv.value}",
                  "momo_code": "${widgets.momo_code.value}"
                }
              }
            }
          ]
        }
      ]
    },
    {
      "id": "s_upload_menu_info",
      "title": "Upload menu",
      "layout": {
        "type": "single_column"
      },
      "widgets": [
        {
          "type": "text_block",
          "id": "w_upload",
          "text": "Upload menu via WhatsApp chat with a PDF or image."
        },
        {
          "type": "footer_buttons",
          "buttons": [
            {
              "id": "BTN_DONE_UPLOAD",
              "title": "Done",
              "action": {
                "type": "data_exchange",
                "id": "a_onboard_uploaded",
                "fields": {
                  "bar_id": "${data.bar_id}"
                }
              }
            }
          ]
        }
      ]
    },
    {
      "id": "s_onboard_publish",
      "title": "Publish menu",
      "layout": {
        "type": "single_column"
      },
      "widgets": [
        {
          "type": "text_block",
          "id": "w_publish_status",
          "text": "OCR progress\n${data.ocr_summary_text}\n\nDraft categories: ${data.draft_categories_count}\nDraft items: ${data.draft_items_count}"
        },
        {
          "type": "footer_buttons",
          "buttons": [
            {
              "id": "BTN_REFRESH_OCR",
              "title": "Refresh status",
              "action": {
                "type": "data_exchange",
                "id": "a_onboard_uploaded",
                "fields": {
                  "bar_id": "${data.bar_id}"
                }
              }
            },
            {
              "id": "BTN_PUBLISH_NOW",
              "title": "Publish now",
              "action": {
                "type": "data_exchange",
                "id": "a_publish_menu",
                "fields": {
                  "bar_id": "${data.bar_id}"
                }
              }
            }
          ]
        }
      ]
    }
  ]
}
