# Migration Notes

## BLOCKED/BROKEN Migrations

### 20251214000000_simplified_mobility_schema.sql.BROKEN
**Status**: DISABLED - DO NOT APPLY

**Issues**:
1. Drops `public.profiles` but later functions still reference it
2. `create_trip` references undefined `_profile_id` parameter
3. Contains stray mid-file `COMMIT;` followed by more SQL
4. `find_matches` still joins `public.profiles` after dropping it
5. Grants too broad (anon access to PII-bearing functions)
6. Would break existing profile/wallet system

**Resolution**: Use incremental migrations instead:
- ✅ 20251213114455_create_whatsapp_users_and_function.sql (bridges to profiles)
- Keep existing profiles/trips schema
- whatsapp_users works alongside profiles (non-destructive)

## Working Migrations (Applied)

1. ✅ 20251213101518_enable_rls_on_public_tables.sql
2. ✅ 20251213103442_add_rls_policies.sql  
3. ✅ 20251213112624_create_user_sessions_table.sql
4. ✅ 20251213114455_create_whatsapp_users_and_function.sql

All webhooks now functional with these 4 migrations.
