# Netlify Configuration for EasyMO Admin Panel (Aurora Redesign)
# Next.js 15 PWA in a pnpm monorepo

[build]
  base = "admin-app"
  publish = ".next"
  # Build workspace dependencies, then the admin app
  # Simplified command for local deployment (dependencies assumed built)
  command = "pnpm build"

[build.environment]
  NODE_VERSION = "20.18.0"
  PNPM_VERSION = "10.18.3"
  NODE_ENV = "production"
  NEXT_PUBLIC_USE_MOCKS = "false"
  NEXT_PUBLIC_UI_V2_ENABLED = "true"

# Next.js plugin for SSR and edge functions
[[plugins]]
  package = "@netlify/plugin-nextjs"

# Handle 404s gracefully for dynamic routes
[[plugins]]
  package = "netlify-plugin-no-more-404"
  [plugins.inputs]
    on404 = "warn"

# Context-specific settings
[context.production]
  environment = { NEXT_PUBLIC_ENV = "production" }

[context.deploy-preview]
  environment = { NEXT_PUBLIC_ENV = "preview" }

[context.branch-deploy]
  environment = { NEXT_PUBLIC_ENV = "staging" }

# Dev settings
[dev]
  command = "pnpm dev"
  port = 3000
  targetPort = 3000
  autoLaunch = true
