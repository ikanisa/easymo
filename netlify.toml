# Netlify configuration for deploying the admin-app
# Note: The 'docs' directory contains only documentation (markdown files), not a deployable app
# The admin-app is a Next.js application that should be built and deployed

[build]
  base = "."
  # Enforce type checks before building to prevent TS regressions reaching prod
  command = "pnpm install --frozen-lockfile && pnpm --filter @va/shared build && pnpm --filter @easymo/commons build && pnpm --filter @easymo/admin-app run type-check && pnpm --filter @easymo/admin-app build"
  publish = "admin-app/.next"

[build.lifecycle]
  postBuild = "pnpm deploy:check && pnpm smoke:netlify"

[build.environment]
  NODE_VERSION = "20"

[functions]
  node_bundler = "nft"
  included_files = [
    "admin-app/node_modules/**",
    "node_modules/.pnpm/styled-jsx@*/node_modules/styled-jsx/**",
    "node_modules/.pnpm/next@*/node_modules/next/**"
  ]

[[plugins]]
  package = "@netlify/plugin-nextjs"
