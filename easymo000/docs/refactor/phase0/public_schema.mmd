erDiagram
  admin_alert_prefs {
    text wa_id "not_null"
    boolean want_alerts "not_null default=true"
    ARRAY channels "not_null default=ARRAY['whatsapp'::text]"
    timestamp_with_time_zone updated_at "not_null default=timezone('utc'::text, now())"
    uuid admin_user_id "nullable"
    text alert_key "nullable"
    boolean enabled "not_null default=true"
  }
  admin_audit_log {
    uuid id "not_null default=gen_random_uuid()"
    text actor_wa "nullable"
    text action "not_null"
    text target "nullable"
    jsonb details "not_null default='{}'::jsonb"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
    uuid admin_user_id "nullable"
    text target_id "nullable"
    jsonb before "nullable"
    jsonb after "nullable"
    text reason "nullable"
  }
  admin_pin_sessions {
    uuid session_id "not_null default=gen_random_uuid()"
    text wa_id "not_null"
    timestamp_with_time_zone unlocked_until "not_null"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
  }
  admin_sessions {
    text wa_id "not_null"
    timestamp_with_time_zone pin_ok_until "nullable"
    timestamp_with_time_zone updated_at "not_null default=timezone('utc'::text, now())"
  }
  admin_submissions {
    text reference "not_null"
    text applicant_name "nullable"
    text status "not_null default='pending'::text"
    timestamp_with_time_zone submitted_at "not_null default=timezone('utc'::text, now())"
  }
  app_config {
    integer id "not_null default=1"
    ARRAY insurance_admin_numbers "not_null default='{}'::text[]"
    timestamp_with_time_zone updated_at "nullable default=now()"
    integer tokens_per_referral "not_null default=10"
    integer referral_daily_cap "not_null default=0"
    integer welcome_bonus_tokens "not_null default=0"
    jsonb wallet_redeem_catalog "not_null default='[]'::jsonb"
    text referral_short_domain "nullable"
    text referral_redeem_rules "nullable"
    text openai_api_key "nullable"
    double_precision search_radius_km "nullable default=10"
    integer max_results "nullable default=9"
    numeric subscription_price "nullable default=0"
    text wa_bot_number_e164 "nullable"
    ARRAY admin_numbers "nullable default=ARRAY[]::text[]"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
    text momo_qr_logo_url "nullable"
    jsonb redeem_catalog "nullable"
    boolean admin_pin_required "not_null default=false"
    text admin_pin_hash "nullable"
  }
  audit_log {
    uuid id "not_null default=gen_random_uuid()"
    text actor "nullable"
    text actor_type "nullable"
    text action "not_null"
    text target_table "nullable"
    text target_id "nullable"
    jsonb diff "not_null default='{}'::jsonb"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
  }
  bar_numbers {
    uuid id "not_null default=gen_random_uuid()"
    uuid bar_id "not_null"
    text number_e164 "not_null"
    USER-DEFINED role "not_null default='staff'::bar_contact_role"
    boolean is_active "not_null default=true"
    timestamp_with_time_zone verified_at "nullable"
    text added_by "nullable"
    timestamp_with_time_zone last_seen_at "nullable"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
    timestamp_with_time_zone updated_at "not_null default=timezone('utc'::text, now())"
    text verification_code_hash "nullable"
    timestamp_with_time_zone verification_expires_at "nullable"
    integer verification_attempts "not_null default=0"
    timestamp_with_time_zone invited_at "nullable"
  }
  bar_settings {
    uuid bar_id "not_null"
    boolean allow_direct_customer_chat "not_null default=false"
    boolean order_auto_ack "not_null default=false"
    integer default_prep_minutes "not_null default=0"
    numeric service_charge_pct "not_null default=0"
    text payment_instructions "nullable"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
    timestamp_with_time_zone updated_at "not_null default=timezone('utc'::text, now())"
  }
  bar_tables {
    uuid id "not_null default=gen_random_uuid()"
    uuid bar_id "not_null"
    text label "not_null"
    text qr_payload "not_null"
    text token_nonce "nullable"
    boolean is_active "not_null default=true"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
    timestamp_with_time_zone updated_at "not_null default=timezone('utc'::text, now())"
    timestamp_with_time_zone last_scan_at "nullable"
  }
  bars {
    uuid id "not_null default=gen_random_uuid()"
    text slug "not_null"
    text name "not_null"
    text location_text "nullable"
    text country "nullable"
    text city_area "nullable"
    text currency "nullable"
    text momo_code "nullable"
    boolean is_active "not_null default=false"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
    timestamp_with_time_zone updated_at "not_null default=timezone('utc'::text, now())"
  }
  basket_contributions {
    uuid id "not_null default=gen_random_uuid()"
    uuid basket_id "not_null"
    uuid contributor_user_id "not_null"
    integer amount_rwf "not_null"
    text status "not_null default='pending'::text"
    timestamp_with_time_zone created_at "not_null default=now()"
    timestamp_with_time_zone approved_at "nullable"
    uuid approver_user_id "nullable"
    text wa_message_id "nullable"
    integer amount_minor "nullable"
    text currency "not_null default='RWF'::text"
    text momo_reference "nullable"
    text source "nullable"
    jsonb metadata "not_null default='{}'::jsonb"
    uuid profile_id "nullable"
  }
  basket_joins {
    uuid id "not_null default=gen_random_uuid()"
    uuid basket_id "not_null"
    uuid user_id "nullable"
    boolean via_token "nullable"
    text source "nullable"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
    text whatsapp "nullable"
    text invite_source "nullable"
    text status "not_null default='pending'::text"
    jsonb metadata "not_null default='{}'::jsonb"
    timestamp_with_time_zone processed_at "nullable"
  }
  basket_members {
    uuid basket_id "not_null"
    uuid user_id "not_null"
    text role "nullable default='member'::text"
    timestamp_with_time_zone created_at "nullable default=now()"
    text member_code "nullable"
    numeric total_contributed "nullable"
    text whatsapp "nullable"
    uuid profile_id "nullable"
    timestamp_with_time_zone joined_at "not_null default=timezone('utc'::text, now())"
    text joined_via "nullable"
    text join_reference "nullable"
  }
  baskets {
    uuid id "not_null default=gen_random_uuid()"
    text name "not_null"
    text description "nullable"
    USER-DEFINED type "not_null"
    USER-DEFINED status "not_null default='draft'::basket_status"
    text public_slug "nullable"
    uuid creator_id "nullable"
    timestamp_with_time_zone created_at "nullable default=now()"
    text momo_payee_number "nullable"
    text momo_ussd_code "nullable"
    text momo_target "nullable"
    boolean momo_is_code "nullable"
    uuid owner_profile_id "nullable"
    text owner_whatsapp "nullable"
    boolean is_public "not_null default=false"
    integer goal_minor "nullable"
    text currency "not_null default='RWF'::text"
    text share_token "nullable"
    double_precision lat "nullable"
    double_precision lng "nullable"
    timestamp_with_time_zone updated_at "not_null default=timezone('utc'::text, now())"
    uuid creator_user_id "nullable"
    text momo_number_or_code "nullable"
    text join_token "nullable"
    boolean join_token_revoked "not_null default=false"
    jsonb metadata "not_null default='{}'::jsonb"
  }
  businesses {
    uuid id "not_null default=gen_random_uuid()"
    text owner_whatsapp "not_null"
    text name "not_null"
    text description "nullable"
    USER-DEFINED geo "nullable"
    boolean is_active "not_null default=true"
    timestamp_with_time_zone created_at "nullable default=now()"
    bigint category_id "nullable"
    text catalog_url "nullable"
    text location_text "nullable"
    double_precision lat "nullable"
    double_precision lng "nullable"
    uuid owner_user_id "nullable"
    USER-DEFINED location "nullable"
    text status "nullable"
  }
  campaign_recipients {
    bigint id "not_null default=nextval('campaign_recipients_id_seq'::regclass)"
    bigint campaign_id "nullable"
    bigint contact_id "nullable"
    text msisdn_e164 "not_null"
    boolean send_allowed "nullable default=true"
    boolean window_24h_open "nullable default=false"
  }
  campaigns {
    bigint id "not_null default=nextval('campaigns_id_seq'::regclass)"
    text title "not_null"
    bigint template_id "nullable"
    text message_kind "not_null"
    jsonb payload "not_null"
    jsonb target_audience "not_null"
    timestamp_with_time_zone scheduled_at "nullable"
    text time_zone "nullable default='Africa/Kigali'::text"
    text status "nullable default='DRAFT'::text"
    timestamp_with_time_zone created_at "nullable default=now()"
  }
  cart_items {
    uuid id "not_null default=gen_random_uuid()"
    uuid cart_id "not_null"
    uuid item_id "nullable"
    text item_name "not_null"
    jsonb item_snapshot "not_null default='{}'::jsonb"
    integer qty "not_null"
    integer unit_price_minor "not_null"
    jsonb flags_snapshot "not_null default='[]'::jsonb"
    jsonb modifiers_snapshot "not_null default='[]'::jsonb"
    integer line_total_minor "not_null"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
  }
  carts {
    uuid id "not_null default=gen_random_uuid()"
    uuid bar_id "not_null"
    text table_label "nullable"
    USER-DEFINED status "not_null default='open'::cart_status"
    integer subtotal_minor "not_null default=0"
    integer service_charge_minor "not_null default=0"
    integer total_minor "not_null default=0"
    timestamp_with_time_zone expires_at "nullable"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
    timestamp_with_time_zone updated_at "not_null default=timezone('utc'::text, now())"
    uuid profile_id "not_null"
  }
  categories {
    uuid id "not_null default=gen_random_uuid()"
    uuid bar_id "not_null"
    uuid menu_id "not_null"
    uuid parent_category_id "nullable"
    text name "not_null"
    integer sort_order "not_null default=0"
    boolean is_deleted "not_null default=false"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
    timestamp_with_time_zone updated_at "not_null default=timezone('utc'::text, now())"
  }
  chat_sessions {
    text user_id "not_null"
    jsonb state "nullable"
    timestamp_with_time_zone updated_at "nullable default=now()"
  }
  chat_state {
    uuid user_id "not_null"
    jsonb state "not_null default='{}'::jsonb"
    timestamp_with_time_zone updated_at "not_null default=now()"
    text state_key "nullable"
  }
  contacts {
    bigint id "not_null default=nextval('contacts_id_seq'::regclass)"
    text msisdn_e164 "not_null"
    text full_name "nullable"
    text sector "nullable"
    text city "nullable"
    ARRAY tags "nullable default='{}'::text[]"
    jsonb attributes "nullable default='{}'::jsonb"
    boolean opted_in "not_null default=false"
    text opt_in_source "nullable"
    timestamp_with_time_zone opt_in_ts "nullable"
    boolean opted_out "not_null default=false"
    timestamp_with_time_zone opt_out_ts "nullable"
    timestamp_with_time_zone last_inbound_ts "nullable"
    timestamp_with_time_zone last_inbound_at "nullable"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
  }
  contributions {
    uuid id "not_null default=gen_random_uuid()"
    uuid basket_id "not_null"
    uuid user_id "nullable"
    numeric amount "nullable"
    text currency "nullable"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
  }
  driver_status {
    uuid user_id "not_null"
    text vehicle_type "nullable"
    USER-DEFINED location "nullable"
    timestamp_with_time_zone last_seen "nullable"
    boolean online "nullable default=true"
    double_precision lat "nullable"
    double_precision lng "nullable"
    timestamp_with_time_zone updated_at "not_null default=timezone('utc'::text, now())"
  }
  drivers_available {
    uuid id "not_null default=gen_random_uuid()"
    text whatsapp "not_null"
    text vehicle_type "nullable"
    USER-DEFINED geo "nullable"
    timestamp_with_time_zone served_at "nullable"
    text served_by "nullable"
    timestamp_with_time_zone created_at "nullable default=now()"
  }
  flow_submissions {
    uuid id "not_null default=gen_random_uuid()"
    text flow_id "not_null"
    text screen_id "nullable"
    text action_id "nullable"
    text wa_id "nullable"
    jsonb payload "not_null default='{}'::jsonb"
    timestamp_with_time_zone received_at "not_null default=timezone('utc'::text, now())"
  }
  geography_columns {
    name f_table_catalog "nullable"
    name f_table_schema "nullable"
    name f_table_name "nullable"
    name f_geography_column "nullable"
    integer coord_dimension "nullable"
    integer srid "nullable"
    text type "nullable"
  }
  geometry_columns {
    character_varying f_table_catalog "nullable"
    name f_table_schema "nullable"
    name f_table_name "nullable"
    name f_geometry_column "nullable"
    integer coord_dimension "nullable"
    integer srid "nullable"
    character_varying type "nullable"
  }
  insurance_leads {
    uuid id "not_null default=gen_random_uuid()"
    text whatsapp "not_null"
    text file_path "nullable"
    jsonb raw_ocr "nullable"
    jsonb extracted "nullable"
    timestamp_with_time_zone created_at "nullable default=now()"
    jsonb extracted_json "nullable"
    text status "not_null default='received'::text"
  }
  insurance_media {
    uuid id "not_null default=gen_random_uuid()"
    uuid lead_id "nullable"
    text wa_media_id "nullable"
    text storage_path "not_null"
    text mime_type "nullable"
    timestamp_with_time_zone created_at "nullable default=now()"
  }
  insurance_media_queue {
    uuid id "not_null default=gen_random_uuid()"
    uuid profile_id "nullable"
    text wa_id "nullable"
    text storage_path "not_null"
    text mime_type "nullable"
    text caption "nullable"
    text status "not_null default='queued'::text"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
  }
  item_modifiers {
    uuid id "not_null default=gen_random_uuid()"
    uuid item_id "not_null"
    text name "not_null"
    USER-DEFINED modifier_type "not_null"
    boolean is_required "not_null default=false"
    jsonb options "not_null default='[]'::jsonb"
    integer sort_order "not_null default=0"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
    timestamp_with_time_zone updated_at "not_null default=timezone('utc'::text, now())"
  }
  items {
    uuid id "not_null default=gen_random_uuid()"
    uuid bar_id "not_null"
    uuid menu_id "not_null"
    uuid category_id "nullable"
    text name "not_null"
    text short_description "nullable"
    integer price_minor "not_null"
    text currency "nullable"
    jsonb flags "not_null default='[]'::jsonb"
    boolean is_available "not_null default=true"
    integer sort_order "not_null default=0"
    jsonb metadata "not_null default='{}'::jsonb"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
    timestamp_with_time_zone updated_at "not_null default=timezone('utc'::text, now())"
  }
  leaderboard_notifications {
    uuid user_id "not_null"
    text window "not_null"
    timestamp_with_time_zone last_entered_at "nullable"
    timestamp_with_time_zone last_dropped_at "nullable"
  }
  leaderboard_snapshots {
    text window "not_null"
    timestamp_with_time_zone generated_at "not_null default=now()"
    jsonb payload "not_null"
    uuid id "nullable default=gen_random_uuid()"
    text snapshot_window "nullable"
    jsonb top9 "nullable"
    jsonb your_rank_map "nullable"
  }
  leaderboard_snapshots_v {
    uuid id "nullable"
    text window "nullable"
    timestamp_with_time_zone generated_at "nullable"
    jsonb top9 "nullable"
    jsonb your_rank_map "nullable"
  }
  marketplace_categories {
    bigint id "not_null default=nextval('marketplace_categories_id_seq'::regclass)"
    text name "not_null"
    boolean is_active "not_null default=true"
    integer sort_order "nullable"
    timestamp_with_time_zone created_at "nullable default=now()"
  }
  menus {
    uuid id "not_null default=gen_random_uuid()"
    uuid bar_id "not_null"
    integer version "not_null default=1"
    USER-DEFINED status "not_null default='draft'::menu_status"
    USER-DEFINED source "not_null default='manual'::menu_source"
    ARRAY source_file_ids "not_null default=ARRAY[]::text[]"
    text created_by "nullable"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
    timestamp_with_time_zone updated_at "not_null default=timezone('utc'::text, now())"
    timestamp_with_time_zone published_at "nullable"
  }
  mobility_pro_access {
    uuid user_id "not_null"
    integer credits_left "not_null default=0"
    timestamp_with_time_zone granted_until "nullable"
    timestamp_with_time_zone updated_at "not_null default=timezone('utc'::text, now())"
  }
  momo_qr_requests {
    uuid id "not_null default=gen_random_uuid()"
    uuid user_id "nullable"
    text whatsapp_e164 "not_null"
    text kind "not_null"
    text momo_value "not_null"
    integer amount_rwf "nullable"
    text ussd_text "not_null"
    text tel_uri "not_null"
    text qr_url "not_null"
    text share_url "nullable"
    timestamp_with_time_zone created_at "not_null default=now()"
    text requester_wa_id "nullable"
    text target_value "nullable"
    text target_type "nullable"
    integer amount_minor "nullable"
    text ussd_code "nullable"
    text msisdn_or_code "nullable"
    numeric amount "nullable"
    text ussd "nullable"
  }
  notifications {
    uuid id "not_null default=gen_random_uuid()"
    uuid order_id "nullable"
    text to_wa_id "not_null"
    text template_name "nullable"
    text notification_type "not_null"
    USER-DEFINED channel "not_null default='template'::notification_channel"
    USER-DEFINED status "not_null default='queued'::notification_status"
    jsonb payload "not_null default='{}'::jsonb"
    text error_message "nullable"
    timestamp_with_time_zone sent_at "nullable"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
    integer retry_count "not_null default=0"
    timestamp_with_time_zone next_attempt_at "nullable"
    timestamp_with_time_zone locked_at "nullable"
  }
  ocr_jobs {
    uuid id "not_null default=gen_random_uuid()"
    uuid bar_id "not_null"
    uuid menu_id "nullable"
    text source_file_id "nullable"
    USER-DEFINED status "not_null default='queued'::ocr_job_status"
    text error_message "nullable"
    smallint attempts "not_null default=0"
    timestamp_with_time_zone last_attempt_at "nullable"
    text result_path "nullable"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
    timestamp_with_time_zone updated_at "not_null default=timezone('utc'::text, now())"
  }
  order_events {
    uuid id "not_null default=gen_random_uuid()"
    uuid order_id "not_null"
    USER-DEFINED event_type "not_null"
    USER-DEFINED actor_type "not_null"
    text actor_identifier "nullable"
    text note "nullable"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
  }
  order_items {
    uuid id "not_null default=gen_random_uuid()"
    uuid order_id "not_null"
    uuid item_id "nullable"
    text item_name "not_null"
    text item_description "nullable"
    integer qty "not_null"
    integer unit_price_minor "not_null"
    jsonb flags_snapshot "not_null default='[]'::jsonb"
    jsonb modifiers_snapshot "not_null default='[]'::jsonb"
    integer line_total_minor "not_null"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
  }
  orders {
    uuid id "not_null default=gen_random_uuid()"
    text order_code "nullable"
    uuid bar_id "not_null"
    uuid source_cart_id "nullable"
    text table_label "nullable"
    USER-DEFINED status "not_null default='pending'::order_status"
    integer subtotal_minor "not_null default=0"
    integer service_charge_minor "not_null default=0"
    integer total_minor "not_null default=0"
    text momo_code_used "nullable"
    text note "nullable"
    timestamp_with_time_zone paid_at "nullable"
    timestamp_with_time_zone served_at "nullable"
    timestamp_with_time_zone cancelled_at "nullable"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
    timestamp_with_time_zone updated_at "not_null default=timezone('utc'::text, now())"
    uuid profile_id "nullable"
  }
  passengers_requests {
    uuid id "not_null default=gen_random_uuid()"
    text whatsapp "not_null"
    text vehicle_type "nullable"
    USER-DEFINED geo "nullable"
    timestamp_with_time_zone served_at "nullable"
    text served_by "nullable"
    timestamp_with_time_zone created_at "nullable default=now()"
  }
  petrol_stations {
    uuid id "not_null default=gen_random_uuid()"
    text name "not_null"
    text city "nullable"
    text owner_contact "nullable"
    text status "not_null default='active'::text"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
    timestamp_with_time_zone updated_at "not_null default=timezone('utc'::text, now())"
  }
  profiles {
    uuid user_id "not_null default=gen_random_uuid()"
    text whatsapp_e164 "not_null"
    text display_name "nullable"
    text locale "nullable default='en'::text"
    timestamp_with_time_zone created_at "nullable default=now()"
    boolean show_on_leaderboards "not_null default=true"
    jsonb metadata "not_null default='{}'::jsonb"
    uuid id "nullable"
  }
  promo_rules {
    integer id "not_null default=1"
    integer tokens_per_new_user "not_null default=10"
    integer welcome_bonus "nullable"
    integer daily_cap_per_sharer "nullable"
  }
  published_menus {
    uuid id "nullable"
    uuid bar_id "nullable"
    integer version "nullable"
    USER-DEFINED status "nullable"
    USER-DEFINED source "nullable"
    ARRAY source_file_ids "nullable"
    text created_by "nullable"
    timestamp_with_time_zone created_at "nullable"
    timestamp_with_time_zone updated_at "nullable"
    timestamp_with_time_zone published_at "nullable"
  }
  referral_attributions {
    uuid id "not_null default=gen_random_uuid()"
    text code "not_null"
    uuid sharer_user_id "not_null"
    uuid joiner_user_id "not_null"
    timestamp_with_time_zone first_message_at "not_null"
    boolean credited "not_null default=false"
    integer credited_tokens "not_null default=0"
    text reason "nullable"
    timestamp_with_time_zone created_at "not_null default=now()"
  }
  referral_clicks {
    uuid id "not_null default=gen_random_uuid()"
    text code "nullable"
    timestamp_with_time_zone clicked_at "not_null default=timezone('utc'::text, now())"
    text ip "nullable"
    text user_agent "nullable"
    text country_guess "nullable"
  }
  referral_links {
    uuid user_id "not_null"
    text code "not_null"
    text short_url "nullable"
    boolean active "not_null default=true"
    timestamp_with_time_zone created_at "not_null default=now()"
    timestamp_with_time_zone last_shared_at "nullable"
  }
  segments {
    bigint id "not_null default=nextval('segments_id_seq'::regclass)"
    text name "not_null"
    text description "nullable"
    jsonb filter "not_null default='{}'::jsonb"
    timestamp_with_time_zone created_at "nullable default=now()"
  }
  send_logs {
    bigint id "not_null default=nextval('send_logs_id_seq'::regclass)"
    bigint queue_id "nullable"
    bigint campaign_id "not_null"
    text msisdn_e164 "not_null"
    timestamp_with_time_zone sent_at "nullable"
    text provider_msg_id "nullable"
    text delivery_status "nullable"
    text error "nullable"
  }
  send_queue {
    bigint id "not_null default=nextval('send_queue_id_seq'::regclass)"
    bigint campaign_id "nullable"
    text msisdn_e164 "not_null"
    jsonb payload "not_null"
    integer attempt "nullable default=0"
    timestamp_with_time_zone next_attempt_at "nullable default=now()"
    text status "nullable default='PENDING'::text"
  }
  served_drivers {
    text viewer_passenger_msisdn "not_null"
    timestamp_with_time_zone expires_at "not_null"
    timestamp_with_time_zone created_at "not_null default=now()"
    uuid driver_contact_id "not_null"
  }
  served_passengers {
    text viewer_driver_msisdn "not_null"
    uuid passenger_trip_id "not_null"
    timestamp_with_time_zone expires_at "not_null"
    timestamp_with_time_zone created_at "not_null default=now()"
  }
  sessions {
    uuid id "not_null default=gen_random_uuid()"
    text wa_id "not_null"
    USER-DEFINED role "not_null"
    uuid bar_id "nullable"
    text current_flow "nullable"
    jsonb context "not_null default='{}'::jsonb"
    jsonb flow_state "not_null default='{}'::jsonb"
    timestamp_with_time_zone last_interaction_at "not_null default=timezone('utc'::text, now())"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
    timestamp_with_time_zone updated_at "not_null default=timezone('utc'::text, now())"
    uuid profile_id "nullable"
  }
  shops {
    uuid id "not_null default=gen_random_uuid()"
    text name "not_null"
    text short_code "not_null"
    boolean is_active "not_null default=true"
    timestamp_with_time_zone created_at "not_null default=now()"
  }
  spatial_ref_sys {
    integer srid "not_null"
    character_varying auth_name "nullable"
    integer auth_srid "nullable"
    character_varying srtext "nullable"
    character_varying proj4text "nullable"
  }
  station_numbers {
    uuid station_id "not_null"
    text wa_e164 "not_null"
    text role "not_null default='staff'::text"
    boolean active "not_null default=true"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
  }
  templates {
    bigint id "not_null default=nextval('templates_id_seq'::regclass)"
    text name "not_null"
    text language_code "not_null default='en'::text"
    text category "nullable"
    text status "not_null"
    text meta_id "nullable"
    jsonb components "not_null"
    jsonb sample "nullable default='{}'::jsonb"
    timestamp_with_time_zone last_synced_at "nullable"
  }
  trips {
    uuid id "not_null default=gen_random_uuid()"
    uuid creator_user_id "nullable"
    text role "nullable"
    text vehicle_type "nullable"
    USER-DEFINED pickup "nullable"
    text status "nullable"
    timestamp_with_time_zone created_at "nullable default=now()"
    USER-DEFINED dropoff "nullable"
    double_precision pickup_lat "nullable"
    double_precision pickup_lng "nullable"
    double_precision dropoff_lat "nullable"
    double_precision dropoff_lng "nullable"
    timestamp_with_time_zone updated_at "not_null default=timezone('utc'::text, now())"
    text pickup_text "nullable"
    text dropoff_text "nullable"
    timestamp_with_time_zone pickup_at "not_null default=timezone('utc'::text, now())"
    double_precision pickup_lon "nullable"
    double_precision dropoff_lon "nullable"
    integer pickup_radius_m "not_null default=200"
    integer dropoff_radius_m "not_null default=200"
  }
  voucher_redemptions {
    uuid id "not_null default=gen_random_uuid()"
    uuid voucher_id "not_null"
    uuid station_id "nullable"
    text redeemer_wa_e164 "nullable"
    text reason "nullable"
    jsonb meta "not_null default='{}'::jsonb"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
  }
  vouchers {
    uuid id "not_null default=gen_random_uuid()"
    text code_5 "not_null"
    integer amount_minor "not_null"
    text currency "not_null default='RWF'::text"
    text status "not_null default='issued'::text"
    uuid user_id "nullable"
    text whatsapp_e164 "not_null"
    text policy_number "not_null"
    text plate "nullable"
    text qr_payload "not_null"
    text image_url "nullable"
    uuid issued_by_admin "nullable"
    timestamp_with_time_zone issued_at "not_null default=timezone('utc'::text, now())"
    timestamp_with_time_zone redeemed_at "nullable"
    uuid redeemed_by_station_id "nullable"
    text notes "nullable"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
    timestamp_with_time_zone updated_at "not_null default=timezone('utc'::text, now())"
  }
  wa_events {
    text wa_message_id "not_null"
    timestamp_with_time_zone created_at "not_null default=now()"
    timestamp_with_time_zone received_at "not_null default=timezone('utc'::text, now())"
  }
  wa_inbound {
    text wa_msg_id "not_null"
    text from_msisdn "nullable"
    timestamp_with_time_zone received_at "nullable default=now()"
  }
  wa_inbox {
    bigint id "not_null default=nextval('wa_inbox_id_seq'::regclass)"
    text provider_msg_id "nullable"
    text from_msisdn "not_null"
    text to_msisdn "nullable"
    timestamp_with_time_zone wa_timestamp "nullable"
    text type "nullable"
    jsonb payload "not_null default='{}'::jsonb"
    timestamp_with_time_zone created_at "nullable default=now()"
  }
  wallet_accounts {
    uuid profile_id "not_null"
    integer balance_minor "not_null default=0"
    integer pending_minor "not_null default=0"
    text currency "not_null default='RWF'::text"
    integer tokens "not_null default=0"
    timestamp_with_time_zone updated_at "not_null default=timezone('utc'::text, now())"
  }
  wallet_earn_actions {
    uuid id "not_null default=gen_random_uuid()"
    text title "nullable"
    text description "nullable"
    integer reward_tokens "nullable"
    text referral_code "nullable"
    text share_text "nullable"
    boolean is_active "not_null default=true"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
  }
  wallet_ledger {
    bigint id "not_null default=nextval('wallet_ledger_id_seq'::regclass)"
    uuid user_id "not_null"
    integer delta_tokens "not_null"
    text type "not_null"
    jsonb meta "not_null default='{}'::jsonb"
    timestamp_with_time_zone created_at "not_null default=now()"
  }
  wallet_promoters {
    uuid id "not_null default=gen_random_uuid()"
    text display_name "nullable"
    text whatsapp "nullable"
    integer tokens "not_null default=0"
    timestamp_with_time_zone updated_at "not_null default=timezone('utc'::text, now())"
  }
  wallet_redeem_options {
    uuid id "not_null default=gen_random_uuid()"
    text title "nullable"
    text description "nullable"
    integer cost_tokens "nullable"
    text instructions "nullable"
    boolean is_active "not_null default=true"
    timestamp_with_time_zone created_at "not_null default=timezone('utc'::text, now())"
  }
  wallet_redemptions {
    uuid id "not_null default=gen_random_uuid()"
    uuid user_id "not_null"
    text reward_id "not_null"
    text reward_name "not_null"
    integer cost_tokens "not_null"
    text status "not_null default='fulfilled'::text"
    jsonb meta "not_null default='{}'::jsonb"
    timestamp_with_time_zone created_at "not_null default=now()"
  }
  wallet_transactions {
    uuid id "not_null default=gen_random_uuid()"
    uuid profile_id "nullable"
    integer amount_minor "not_null"
    text currency "not_null default='RWF'::text"
    text direction "not_null default='credit'::text"
    text description "nullable"
    timestamp_with_time_zone occurred_at "not_null default=timezone('utc'::text, now())"
  }
  wallets {
    uuid user_id "not_null"
    integer balance_tokens "not_null default=0"
    timestamp_with_time_zone updated_at "not_null default=now()"
  }
  webhook_logs {
    bigint id "not_null default=nextval('webhook_logs_id_seq'::regclass)"
    text endpoint "not_null"
    text wa_id "nullable"
    integer status_code "nullable"
    text error_message "nullable"
    jsonb headers "not_null default='{}'::jsonb"
    jsonb payload "not_null default='{}'::jsonb"
    timestamp_with_time_zone received_at "not_null default=timezone('utc'::text, now())"
  }
  admin_alert_prefs }o--|| profiles : "admin_user_id → user_id"
  admin_audit_log }o--|| profiles : "admin_user_id → user_id"
  bar_numbers ||--|| bars : "bar_id → id"
  bar_settings ||--|| bars : "bar_id → id"
  bar_tables ||--|| bars : "bar_id → id"
  basket_contributions }o--|| profiles : "profile_id → user_id"
  basket_joins }o--|| profiles : "user_id → user_id"
  basket_joins ||--|| baskets : "basket_id → id"
  basket_members ||--|| baskets : "basket_id → id"
  basket_members ||--|| profiles : "user_id → user_id"
  baskets }o--|| profiles : "creator_id → user_id"
  baskets }o--|| profiles : "creator_user_id → user_id"
  businesses }o--|| profiles : "owner_user_id → user_id"
  businesses }o--|| marketplace_categories : "category_id → id"
  campaign_recipients }o--|| contacts : "contact_id → id"
  campaign_recipients }o--|| campaigns : "campaign_id → id"
  campaigns }o--|| templates : "template_id → id"
  cart_items ||--|| carts : "cart_id → id"
  carts ||--|| bars : "bar_id → id"
  carts ||--|| profiles : "profile_id → user_id"
  categories ||--|| menus : "menu_id → id"
  categories }o--|| categories : "parent_category_id → id"
  categories ||--|| bars : "bar_id → id"
  chat_state ||--|| profiles : "user_id → user_id"
  contributions }o--|| profiles : "user_id → user_id"
  contributions ||--|| baskets : "basket_id → id"
  insurance_media }o--|| insurance_leads : "lead_id → id"
  insurance_media_queue }o--|| profiles : "profile_id → user_id"
  item_modifiers ||--|| items : "item_id → id"
  items }o--|| categories : "category_id → id"
  items ||--|| menus : "menu_id → id"
  items ||--|| bars : "bar_id → id"
  leaderboard_notifications ||--|| profiles : "user_id → user_id"
  menus ||--|| bars : "bar_id → id"
  mobility_pro_access ||--|| profiles : "user_id → user_id"
  momo_qr_requests }o--|| profiles : "user_id → user_id"
  notifications }o--|| orders : "order_id → id"
  ocr_jobs }o--|| menus : "menu_id → id"
  ocr_jobs ||--|| bars : "bar_id → id"
  order_events ||--|| orders : "order_id → id"
  order_items ||--|| orders : "order_id → id"
  orders ||--|| bars : "bar_id → id"
  orders }o--|| profiles : "profile_id → user_id"
  orders }o--|| carts : "source_cart_id → id"
  referral_attributions ||--|| profiles : "joiner_user_id → user_id"
  referral_attributions ||--|| profiles : "sharer_user_id → user_id"
  referral_attributions ||--|| referral_links : "code → code"
  referral_links ||--|| profiles : "user_id → user_id"
  send_logs }o--|| send_queue : "queue_id → id"
  send_queue }o--|| campaigns : "campaign_id → id"
  sessions }o--|| bars : "bar_id → id"
  sessions }o--|| profiles : "profile_id → user_id"
  station_numbers ||--|| petrol_stations : "station_id → id"
  voucher_redemptions }o--|| petrol_stations : "station_id → id"
  voucher_redemptions ||--|| vouchers : "voucher_id → id"
  vouchers }o--|| profiles : "issued_by_admin → user_id"
  vouchers }o--|| profiles : "user_id → user_id"
  vouchers }o--|| petrol_stations : "redeemed_by_station_id → id"
  wallet_accounts ||--|| profiles : "profile_id → user_id"
  wallet_ledger ||--|| profiles : "user_id → user_id"
  wallet_redemptions ||--|| profiles : "user_id → user_id"
  wallet_transactions }o--|| profiles : "profile_id → user_id"
  wallets ||--|| profiles : "user_id → user_id"
